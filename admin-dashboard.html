<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - HostelMate</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

body { margin:0; font-family:'Inter', sans-serif; background:#0b1e3c; color:#fff; }

/* Sidebar */
.sidebar {
    position: fixed;
    top:0; left:0;
    width:250px;
    height:100%;
    background: rgba(10,25,50,0.95);
    backdrop-filter: blur(10px);
    display:flex;
    flex-direction:column;
    box-shadow: 5px 0 15px rgba(0,0,0,0.3);
}
.sidebar h2{ text-align:center;padding:20px 0;border-bottom:1px solid rgba(255,255,255,0.2);margin:0;}
.sidebar ul{list-style:none;padding:0;margin:0;flex:1;}
.sidebar ul li{
    padding:15px 20px;
    cursor:pointer;
    border-bottom:1px solid rgba(255,255,255,0.1);
    display:flex;
    align-items:center;
    gap:10px;
    transition:0.3s;
    border-radius:10px 0 0 10px;
}
.sidebar ul li:hover{background: rgba(255,255,255,0.1); box-shadow:0 0 10px #0ff;}
.sidebar ul li.logout {
    margin-top: 30px;
    margin-bottom: 20px;
    background: linear-gradient(135deg, #ff758c, #ff7eb3);
    justify-content:center;
    border-radius:25px;
    padding:10px 0;
    font-weight:bold;
}
.sidebar ul li.logout:hover{
    background: linear-gradient(135deg, #ff7eb3, #ff758c);
    box-shadow: 0 0 15px #ff7eb3, 0 0 25px #ff758c;
    transform: translateY(-2px);
}
.sidebar ul li .badge{
    background:red;color:#000;border-radius:50%;width:20px;height:20px;text-align:center;line-height:20px;font-size:12px;
}

/* Main content */
.main-content{ margin-left:250px; padding:20px; }

/* Header */
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.header .logo { height:70px; border-radius: 12px; box-shadow: 0 0 15px #0ff; transition: 0.3s; }
.header h1{margin-left:20px;font-size:24px;color:#0ff;}

/* Profile pic edit */
.profile-section{position:relative;}
.profile-pic-wrapper{position:relative;display:inline-block;}
.profile-pic{width:60px;height:60px;border-radius:50%;object-fit:cover;border:2px solid #0ff;transition:0.3s;}
.profile-pic:hover{box-shadow:0 0 15px #0ff;}
.edit-pen{position:absolute;bottom:-5px;right:-5px;background:#0ff;color:#000;border-radius:50%;padding:5px;cursor:pointer;font-size:12px;border:1px solid #fff;}

/* Profile Modal */
#profileModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter: blur(5px);justify-content:center;align-items:center;z-index:1000;}
#profileModal .modal-content{
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(15px);
    padding:30px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 20px #0ff;
}
#profileModal img{width:120px;height:120px;border-radius:50%;object-fit:cover;margin-bottom:20px;border:3px solid #0ff;}

/* Cards */
.dashboard-cards{display:flex;gap:20px;flex-wrap:wrap;margin-bottom:20px;}
.card{
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    flex:1 1 200px;
    padding:20px;
    border-radius:15px;
    box-shadow:0 4px 15px rgba(0,255,255,0.2);
    transition:0.3s;
    cursor:pointer;
    position:relative;
}
.card:hover{box-shadow:0 0 25px #0ff;}
.card h3{margin:0;font-size:14px;color:#c0eaff;}
.card p{font-size:24px;margin:5px 0 0 0;font-weight:700;}
.card .edit-card{ position:absolute; top:10px; right:10px; font-size:16px; cursor:pointer; color:#0ff; padding:5px; border-radius:50%; border:1px solid #0ff; transition:0.3s; }
.card .edit-card:hover{ box-shadow:0 0 10px #0ff,0 0 20px #0ff; transform: translateY(-2px); }

/* Tables */
table{width:100%;border-collapse:collapse;background:rgba(255,255,255,0.1);border-radius:15px;overflow:hidden;backdrop-filter:blur(5px);margin-top:20px;}
table th, table td{padding:12px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);color:#c0eaff;}
table th{background:rgba(255,255,255,0.05);}
table tr:hover{background: rgba(0,255,255,0.1);}

/* Tabs */
.tab{display:none;}
.tab.active{display:block;}

/* Floating add button */
.add-student-btn{
    position: fixed;
    bottom:30px;
    right:40px;
    width:60px;height:60px;border-radius:50%;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    color: #0ff;
    font-size:30px;
    text-align:center;
    line-height:60px;
    cursor:pointer;
    box-shadow:0 0 10px #0ff;
    transition:0.3s;
}
.add-student-btn:hover{
    box-shadow:0 0 20px #0ff,0 0 40px #0ff;
    transform: translateY(-2px);
}

/* Message box for lost & found */
.lost-box{margin-top:10px;padding:10px;background:rgba(0,255,255,0.1);border-radius:10px;display:flex;justify-content:space-between;align-items:center;}
.lost-box button{padding:5px 10px;border-radius:12px;border:none;background: rgba(255,255,255,0.1);backdrop-filter: blur(10px);color:#0ff;font-weight:600;transition:0.3s;cursor:pointer;box-shadow:0 0 5px rgba(0,255,255,0.3);}
.lost-box button:hover{background: rgba(0,255,255,0.2);color:#000;box-shadow:0 0 15px #0ff,0 0 25px #0ff;transform:translateY(-2px);}

/* General buttons (glassmorphism) */
button{ padding: 8px 16px; border: none; border-radius: 12px; cursor: pointer; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); color: #0ff; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);}
button:hover{ background: rgba(0, 255, 255, 0.2); color: #000; box-shadow: 0 0 15px #0ff, 0 0 25px #0ff; transform: translateY(-2px);}
input[type=text], textarea{ padding:5px; border-radius:12px; border:none; background: rgba(255,255,255,0.1); color:#0ff; backdrop-filter:blur(10px); outline:none; width:70%;}

/* Mess Schedule Table */
#messTable th, #messTable td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.2);color:#c0eaff;}
#messTable th{background:rgba(255,255,255,0.05);}
.add-row-btn{margin-top:10px;}

/* Student Allotment Table */
#allotmentTable th, #allotmentTable td{
    padding:12px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);color:#c0eaff;
}
#allotmentTable th{background:rgba(255,255,255,0.05);}
#allotmentTable tr:hover{background: rgba(0,255,255,0.1);}
.send-email-btn{padding:5px 12px;border-radius:12px;background: rgba(255,255,255,0.1);backdrop-filter:blur(10px);color:#0ff;cursor:pointer;transition:0.3s;}
.send-email-btn:hover{background: rgba(0,255,255,0.2);color:#000;}

/* Room selection modal */
#roomModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter: blur(5px);justify-content:center;align-items:center;z-index:1000;}
#roomModal .modal-content{
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(15px);
    padding:30px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 20px #0ff;
}
#roomModal select{padding:10px;border-radius:12px;border:none;background: rgba(255,255,255,0.1);color:#0ff;outline:none;}
#roomModal button{margin-top:10px;}


</style>
</head>
<body>

<div class="sidebar">
    <h2>Admin Panel</h2>
    <ul>
        <li onclick="openTab('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
        <li onclick="openTab('students')"><i class="fas fa-user-graduate"></i> Student Management</li>
        <li onclick="openTab('allotment')"><i class="fas fa-layer-group"></i> Student Allotment</li>
        <li onclick="openTab('rooms')"><i class="fas fa-bed"></i> Room Management</li>
        <li onclick="openTab('lostfound')"><i class="fas fa-search"></i> Lost & Found <span class="badge" id="lostBadge">0</span></li>
        <li onclick="openTab('complaints')"><i class="fas fa-exclamation-circle"></i> Complaints <span class="badge" id="complaintBadge">0</span></li>
        <li onclick="openTab('notifications')"><i class="fas fa-bell"></i> Announcements</li>
        <li onclick="openTab('mess')"><i class="fas fa-utensils"></i> Hostel Mess Schedule</li>
        <li onclick="openTab('events')"><i class="fas fa-calendar-alt"></i> Hostel Events</li>
        <li onclick="openTab('hostelDetails')"><i class="fas fa-building"></i> Hostel Details</li>
        <li class="logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</li>
    </ul>
</div>

<div class="main-content">
    <div class="header">
        <div style="display:flex;align-items:center">
            <img src="https://i.ibb.co/LDWnBVWf/59e47443259fadca4151fd6273ac0ebd.jpg" class="logo">
            <h1 id="welcomeText"></h1>
        </div>
        <div class="profile-section">
            <div class="profile-pic-wrapper">
                <img src="https://i.ibb.co/rGv71T90/3cae079ca0b9e55ec6bfc1b358c9b1e2.jpg" class="profile-pic" id="profilePic">
                <i class="fas fa-pen edit-pen" id="editPen"></i>
            </div>
            <input type="file" id="uploadPic" style="display:none;">
        </div>
    </div>
    <!-- Tabs -->
    <div id="dashboard" class="tab active">
        <h2 id="yourHallName">Your Hall: Hall Name</h2>
        <div class="dashboard-cards">
            <div class="card">
                <h3>Total Students</h3>
                <p id="totalStudents">120</p>
                <i class="fas fa-pen edit-card" onclick="makeEditable('totalStudents')"></i>
            </div>
            <div class="card">
                <h3>Total Rooms</h3>
                <p id="totalRooms">50</p>
                <i class="fas fa-pen edit-card" onclick="makeEditable('totalRooms')"></i>
            </div>
            <div class="card">
                <h3>Free Rooms</h3>
                <p id="freeRooms">10</p>
                <i class="fas fa-pen edit-card" onclick="makeEditable('freeRooms')"></i>
            </div>
            <div class="card">
                <h3>Lost Items</h3>
                <p id="lostItems">3</p>
                <i class="fas fa-pen edit-card" onclick="makeEditable('lostItems')"></i>
            </div>
        </div>
        <h3>Other Admins in this Hall</h3>
        <div id="otherAdmins" style="display:flex;gap:10px;"></div>
    </div>
    <!-- Student Management Tab (Existing) -->
    <div id="students" class="tab">
        <h2>Student Management</h2>
        <table id="studentTable">
            <tr><th>Name</th><th>Father Name</th><th>CNIC</th><th>Room</th><th>Action</th></tr>
        </table>
        <div class="add-student-btn" onclick="addStudent()">+</div>
    </div>
    <!-- Student Allotment Tab (New) -->
    <div id="allotment" class="tab">
        <h2>Student Allotment</h2>
        <table id="allotmentTable">
            <tr>
                <th>Name</th>
                <th>Father Name</th>
                <th>CNIC</th>
                <th>Phone No</th>
                <th>Degree Type</th>
                <th>Dep</th>
                <th>Major</th>
                <th>CGPA</th>
                <th>Action</th>
            </tr>
        </table>
        <div class="add-student-btn" onclick="addAllotmentStudent()">+</div>
    </div>
<!-- Rooms Tab -->
    <div id="rooms" class="tab">
        <h2>Room Management</h2>
        <table id="roomTable">
            <tr><th>Room No</th><th>Total Students</th><th>Free Space</th></tr>
        </table>
    </div>

    <!-- Lost & Found Tab -->
    <div id="lostfound" class="tab">
        <h2>Lost & Found</h2>
        <input type="text" id="lostInput" placeholder="Describe lost item...">
        <button onclick="addLost()">Add</button>
        <div id="lostList"></div>
    </div>
    <!-- Complaints Tab -->
    <div id="complaints" class="tab">
        <h2>Complaints</h2>
        <table id="complaintTable">
            <tr><th>Student</th><th>Complaint</th><th>Action</th></tr>
        </table>
    </div>

    <!-- Announcements Tab -->
    <div id="notifications" class="tab">
        <h2>Announcements</h2>
        <textarea placeholder="Write announcement..."></textarea><br>
        <button onclick="sendAnnouncement()">Send</button>
    </div>
    <!-- Mess Tab -->
    <div id="mess" class="tab">
        <h2>Hostel Mess Schedule</h2>
        <table id="messTable">
            <tr>
                <th>Day</th><th>Meal</th><th>Item</th><th>Total Cost</th><th>Time</th><th>Action</th>
            </tr>
        </table>
        <button class="add-row-btn" onclick="addMessRow()">+ Add Row</button>
    </div>

    <!-- Events Tab -->
    <div id="events" class="tab">
        <h2>Hostel Events</h2>
        <textarea id="eventInput" placeholder="Describe the event..." style="width:80%; height:100px;"></textarea><br><br>
        <button onclick="postEvent()">Post Event</button>
        <h3 style="margin-top:30px;">Posted Events:</h3>
        <div id="eventList" style="margin-top:20px;"></div>
    </div>
    

</div>

<!-- Room Selection Modal for Allotment -->
<div id="roomModal">
    <div class="modal-content">
        <h3>Select Room for <span id="modalStudentName"></span></h3>
        <select id="availableRoomsSelect"></select><br>
        <button onclick="confirmRoom()">Send Email to Student</button>
        <button onclick="closeRoomModal()">Cancel</button>
    </div>
</div>

<!-- Profile Modal -->
<div id="profileModal">
    <div class="modal-content">
        <img src="https://i.ibb.co/rGv71T90/3cae079ca0b9e55ec6bfc1b358c9b1e2.jpg" id="modalPic">
        <br>
        <button onclick="document.getElementById('uploadPic').click()">Upload</button>
        <button onclick="removeProfilePic()">Remove</button>
        <button onclick="closeModal()">Back</button>
    </div>
</div>

<script>
// Admin Info
let adminName = localStorage.getItem('adminName') || "Admin";
let adminHall = localStorage.getItem('adminCode') || "Girls Hall 3";
document.getElementById('yourHallName').innerText = `Your Hall: ${adminHall}`;

// Typewriter
let welcomeText = "WELCOME " + adminName.toUpperCase() + "!";
let i = 0;
function typeWriter() {
    if (i < welcomeText.length) {
        document.getElementById("welcomeText").innerHTML += welcomeText.charAt(i);
        i++;
        setTimeout(typeWriter, 100);
    }
}
typeWriter();
// Profile modal
const profilePic=document.getElementById('profilePic'), modal=document.getElementById('profileModal'), modalPic=document.getElementById('modalPic'), uploadPic=document.getElementById('uploadPic');
document.getElementById('editPen').addEventListener('click',()=>{modal.style.display="flex"; modalPic.src=profilePic.src;});
uploadPic.addEventListener('change',(e)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=()=>{profilePic.src=reader.result; modalPic.src=reader.result};reader.readAsDataURL(file);}}); 
function closeModal(){modal.style.display="none";}
function removeProfilePic(){const defaultPfp="https://i.ibb.co/rGv71T90/3cae079ca0b9e55ec6bfc1b358c9b1e2.jpg";profilePic.src=defaultPfp;modalPic.src=defaultPfp;}

// Logout
function logout(){ localStorage.removeItem('adminName'); localStorage.removeItem('adminCode'); window.location.href="index.html"; }

// Tabs
function openTab(tab){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById(tab).classList.add('active');}

// Dashboard cards editable
function makeEditable(id){let el=document.getElementById(id); el.setAttribute("contenteditable","true"); el.focus(); el.style.borderBottom="1px dashed #0ff";}

// Student Management
let students=[{name:"Noorulain",father:"Mr. Ahmed",cnic:"12345-6789012-3",room:"101"}];
function renderStudents(){let table=document.getElementById('studentTable');table.innerHTML='<tr><th>Name</th><th>Father Name</th><th>CNIC</th><th>Room</th><th>Action</th></tr>';students.forEach((s,i)=>{let tr=document.createElement('tr');tr.innerHTML=`<td>${s.name}</td><td>${s.father}</td><td>${s.cnic}</td><td>${s.room}</td><td><button onclick="editStudent(${i})">Edit</button> <button onclick="deleteStudent(${i})">Delete</button></td>`;table.appendChild(tr);});}
function addStudent(){let name=prompt("Student Name");if(!name)return; let father=prompt("Father Name");if(!father)return; let cnic=prompt("CNIC");if(!cnic)return; let room=prompt("Room No");if(!room)return; students.push({name,father,cnic,room}); renderStudents();}
function editStudent(i){let s=students[i]; let name=prompt("Edit Name",s.name);if(name)s.name=name; let father=prompt("Edit Father",s.father); if(father)s.father=father; let cnic=prompt("Edit CNIC",s.cnic); if(cnic)s.cnic=cnic; let room=prompt("Edit Room",s.room); if(room)s.room=room; renderStudents();}
function deleteStudent(i){if(confirm("Delete this student?")){students.splice(i,1);renderStudents();}}
renderStudents();
// Lost & Found
let lostItemsArr = JSON.parse(localStorage.getItem("lostItems") || "[]");
function addLost(){ 
    let desc=document.getElementById('lostInput').value; 
    if(!desc) return; 
    lostItemsArr.push(desc); 
    localStorage.setItem("lostItems", JSON.stringify(lostItemsArr));
    document.getElementById('lostInput').value=""; 
    renderLost();
}
function renderLost(){
    let list=document.getElementById('lostList'); list.innerHTML=""; 
    lostItemsArr.forEach((item,i)=>{
        let div=document.createElement('div'); 
        div.className="lost-box"; 
        div.innerHTML=`<span>${item}</span><button onclick="markFound(${i})">Found</button>`; 
        list.appendChild(div);
    }); 
    document.getElementById('lostBadge').innerText=lostItemsArr.length;
}
function markFound(i){
    lostItemsArr.splice(i,1); 
    localStorage.setItem("lostItems", JSON.stringify(lostItemsArr));
    renderLost();
}
renderLost();

// Announcements
function sendAnnouncement() {
    const textarea = document.querySelector('#notifications textarea');
    const text = textarea.value.trim();
    if (!text) return alert("Please write an announcement!");
    let announcements = JSON.parse(localStorage.getItem("announcements") || "[]");
    announcements.push(text);
    localStorage.setItem("announcements", JSON.stringify(announcements));
    textarea.value = "";
    alert("Announcement Sent!");
    renderAdminAnnouncements();
}
function renderAdminAnnouncements() {
    const tab = document.getElementById('notifications');
    const oldList = tab.querySelector('ul');
    if (oldList) oldList.remove();
    const ul = document.createElement('ul');
    ul.style.marginTop = "15px";
    ul.style.listStyle = "disc";
    ul.style.paddingLeft = "20px";
    const announcements = JSON.parse(localStorage.getItem("announcements") || "[]");
    announcements.forEach(a => {
        const li = document.createElement('li');
        li.textContent = a;
        ul.appendChild(li);
    });
    tab.appendChild(ul);
}
renderAdminAnnouncements();

// Room Management Table
let roomsArr=[{no:"101",total:4,free:1},{no:"102",total:3,free:2},{no:"103",total:4,free:2},{no:"104",total:3,free:1}];
function renderRooms(){let table=document.getElementById('roomTable');table.innerHTML='<tr><th>Room No</th><th>Total Students</th><th>Free Space</th></tr>';roomsArr.forEach(r=>{let tr=document.createElement('tr');tr.innerHTML=`<td>${r.no}</td><td>${r.total}</td><td>${r.free}</td>`;table.appendChild(tr);});}
renderRooms();

// Complaints from student portal
let complaintsArr = [];
function loadComplaintsFromStorage() {
    let stored = JSON.parse(localStorage.getItem("complaints") || "[]");
    complaintsArr = stored.map(c => ({student: c.student || "Student", complaint: c.text}));
    renderComplaints();
}
function renderComplaints(){
    let table=document.getElementById('complaintTable');
    table.innerHTML='<tr><th>Student</th><th>Complaint</th><th>Action</th></tr>';
    complaintsArr.forEach((c,i)=>{
        let tr=document.createElement('tr');
        tr.innerHTML=`<td>${c.student}</td><td>${c.complaint}</td><td><button onclick="resolveComplaint(${i})">Resolve</button></td>`;
        table.appendChild(tr);
    });
     document.getElementById('complaintBadge').innerText=complaintsArr.length;
}
function resolveComplaint(i){
    complaintsArr.splice(i,1);
    let stored = JSON.parse(localStorage.getItem("complaints")||"[]");
    stored.splice(i,1);
    localStorage.setItem("complaints",JSON.stringify(stored));
    renderComplaints();
}
loadComplaintsFromStorage();
setInterval(loadComplaintsFromStorage,5000);

// Mess Schedule with localStorage AND DELETE FUNCTIONALITY
let messArr=JSON.parse(localStorage.getItem("messArr") || "[]");
function addMessRow(){
    let day=prompt("Day");if(!day)return;
    let meal=prompt("Meal"); if(!meal)return;
    let item=prompt("Item"); if(!item)return;
    let cost=prompt("Total Cost"); if(!cost)return;
    let time=prompt("Time"); if(!time)return;
    messArr.push({day,meal,item,cost,time});
    localStorage.setItem("messArr", JSON.stringify(messArr));
    renderMess();
}
function deleteMessRow(index){
    if(confirm("Delete this mess schedule row?")){
        messArr.splice(index, 1);
        localStorage.setItem("messArr", JSON.stringify(messArr));
        renderMess();
    }
}
function renderMess(){
    let table=document.getElementById('messTable');
    table.innerHTML='<tr><th>Day</th><th>Meal</th><th>Item</th><th>Total Cost</th><th>Time</th><th>Action</th></tr>';
    messArr.forEach((m,i)=>{
        let tr=document.createElement('tr'); 
        tr.innerHTML=`<td>${m.day}</td><td>${m.meal}</td><td>${m.item}</td><td>${m.cost}</td><td>${m.time}</td><td><button class="delete-mess-btn" onclick="deleteMessRow(${i})">Delete</button></td>`; 
        table.appendChild(tr);
    });
}
renderMess();
// ===== HOSTEL EVENTS (WITH LOCALSTORAGE) =====
function postEvent(){
    let desc = document.getElementById('eventInput').value.trim(); 
    if(!desc) {
        alert("Please write an event description!");
        return;
    }
    
    // Get existing events from localStorage
    let eventsArr = JSON.parse(localStorage.getItem("hostelEvents") || "[]");
    
    // Add new event
    eventsArr.push(desc);
    
    // Save to localStorage
    localStorage.setItem("hostelEvents", JSON.stringify(eventsArr));
    
    // Clear input
    document.getElementById('eventInput').value = ""; 
    
    // Re-render
    renderEvents();
    alert("Event posted successfully!");
}

function renderEvents(){
    let eventsArr = JSON.parse(localStorage.getItem("hostelEvents") || "[]");
    let list = document.getElementById('eventList');
    list.innerHTML = ""; 
    
    if(eventsArr.length === 0){
        list.innerHTML = "<p style='color:#c0eaff;'>No events posted yet.</p>";
        return;
    }
    
    eventsArr.forEach((e, i)=>{
        let div = document.createElement('div'); 
        div.className = "lost-box"; 
        div.innerHTML = `<span>${e}</span><button onclick="deleteEvent(${i})">Delete</button>`; 
        list.appendChild(div);
    });
}
function deleteEvent(i){
    if(confirm("Delete this event?")){
        let eventsArr = JSON.parse(localStorage.getItem("hostelEvents") || "[]");
        eventsArr.splice(i, 1);
        localStorage.setItem("hostelEvents", JSON.stringify(eventsArr));
        renderEvents();
    }
}

// Load events on page load
renderEvents();
///////////////////////
// Student Allotment JS
let allotmentStudents=[
    {name:"Ali Khan",father:"Mr. Khan",cnic:"12345-1234567-1",phone:"03001234567",degree:"BSCS",dep:"CS",major:"Software",cgpa:"3.5"},
    {name:"Sara Ahmed",father:"Mr. Ahmed",cnic:"23456-2345678-2",phone:"03101234567",degree:"BSIT",dep:"IT",major:"Networking",cgpa:"3.7"}
];
function renderAllotmentStudents(){
    let table=document.getElementById('allotmentTable');
    table.innerHTML='<tr><th>Name</th><th>Father Name</th><th>CNIC</th><th>Phone No</th><th>Degree Type</th><th>Dep</th><th>Major</th><th>CGPA</th><th>Action</th></tr>';
    allotmentStudents.forEach((s,i)=>{
        let tr=document.createElement('tr');
        tr.innerHTML=`<td>${s.name}</td><td>${s.father}</td><td>${s.cnic}</td><td>${s.phone}</td><td>${s.degree}</td><td>${s.dep}</td><td>${s.major}</td><td>${s.cgpa}</td><td><button class="send-email-btn" onclick="openRoomModal(${i})">Allot Room</button></td>`;
        table.appendChild(tr);
    });
}
renderAllotmentStudents();

function addAllotmentStudent(){
    let name=prompt("Name"); if(!name) return;
    let father=prompt("Father Name"); if(!father) return;
    let cnic=prompt("CNIC"); if(!cnic) return;
    let phone=prompt("Phone No"); if(!phone) return;
    let degree=prompt("Degree Type"); if(!degree) return;
    let dep=prompt("Department"); if(!dep) return;
    let major=prompt("Major"); if(!major) return;
    let cgpa=prompt("CGPA"); if(!cgpa) return;
    allotmentStudents.push({name,father,cnic,phone,degree,dep,major,cgpa});
    renderAllotmentStudents();
}
// Room Modal
let selectedStudentIndex=null;
function openRoomModal(index){
    selectedStudentIndex=index;
    document.getElementById('modalStudentName').innerText=allotmentStudents[index].name;
    let select=document.getElementById('availableRoomsSelect');
    select.innerHTML="";
    roomsArr.filter(r=>r.free>0).forEach(r=>{
        let option=document.createElement('option');
        option.value=r.no;
        option.innerText=r.no + " (Free: "+r.free+")";
        select.appendChild(option);
    });
    document.getElementById('roomModal').style.display="flex";
}
function closeRoomModal(){document.getElementById('roomModal').style.display="none";}
function confirmRoom(){
    let room=document.getElementById('availableRoomsSelect').value;
    if(!room) return alert("Select a room");
    alert(`Email sent to ${allotmentStudents[selectedStudentIndex].name} about Room ${room}`);
    // Reduce free space
     roomsArr.find(r=>r.no==room).free--;
    renderRooms();
    closeRoomModal();
}

</script>

</body>
</html>
